# 音声学習アプリケーション

## 概要
このアプリケーションは、ユーザーが音声ファイルをアップロードし、評価を受けながら発音を練習できるWebアプリケーションです。

## 設計思想

### 1. クリーンアーキテクチャの採用
- **ドメイン駆動設計（DDD）の原則**
  - ビジネスロジックをドメインレイヤーに集約
  - エンティティとバリューオブジェクトによる概念の明確化
  - ドメインイベントによる状態変更の追跡

- **依存性逆転の原則（DIP）**
  - ドメインロジックは外部依存を持たない
  - インターフェースによる抽象化
  - 依存性の方向を内側に向ける

### 2. 関数型プログラミングの原則
- **不変性（Immutability）**
  - 状態変更を最小限に抑制
  - 副作用の排除
  - 予測可能性の向上

- **純粋関数**
  - 同じ入力に対して常に同じ出力を返す
  - 副作用のない関数設計
  - テスト容易性の向上

### 3. テスト駆動開発（TDD）
- **テストファースト**
  - 要件をテストとして表現
  - テストによる設計の導出
  - リファクタリングの安全性確保

- **テストの階層化**
  - ユニットテスト：個々のコンポーネント
  - インテグレーションテスト：コンポーネント間の連携
  - E2Eテスト：ユーザー視点の機能確認

### 4. 国際化（i18n）の設計
- **言語の分離**
  - 翻訳キーの体系化
  - コンポーネントスコープでの翻訳管理
  - 動的な言語切り替え

- **文化適応**
  - 日付・時刻のフォーマット
  - 数値の表示形式
  - 文字の方向性

### 5. セキュリティ設計
- **認証・認可**
  - JWTによるトークン管理
  - ロールベースのアクセス制御
  - セッション管理の最適化

- **データ保護**
  - 入力値のバリデーション
  - XSS対策
  - CSRF対策

### 6. パフォーマンス最適化
- **レンダリング最適化**
  - コンポーネントの分割
  - メモ化による再レンダリング制御
  - 遅延ローディング

- **データフェッチング**
  - キャッシュ戦略
  - プリフェッチング
  - エラーハンドリング

### 7. エラーハンドリング
- **エラーの分類**
  - ドメインエラー
  - インフラストラクチャエラー
  - アプリケーションエラー

- **エラー回復**
  - グレースフルデグラデーション
  - リトライ戦略
  - ユーザーフィードバック

## 技術スタック
- フロントエンド: Next.js + TypeScript
- バックエンド: Supabase
- テスト: Vitest + Testing Library
- スタイリング: Tailwind CSS
- 国際化: i18n

## アーキテクチャ
このアプリケーションは、クリーンアーキテクチャの原則に従って実装されています。

### レイヤー構造
1. **ドメインレイヤー** (`domain/`)
   - エンティティ: `User`, `AudioFile`, `AudioEvaluation`
   - リポジトリインターフェース: `UserRepository`, `AudioFileRepository`, `AudioEvaluationRepository`

2. **アプリケーションレイヤー** (`application/`)
   - ユースケース: `AuthUseCase`, `AudioUploadUseCase`, `AudioEvaluationUseCase`

3. **インフラストラクチャレイヤー** (`infra/`)
   - リポジトリ実装: `UserRepositoryImpl`, `AudioFileRepositoryImpl`, `AudioEvaluationRepositoryImpl`

4. **UIレイヤー** (`components/`)
   - コンポーネント: `AuthForm`, `AudioUpload`, `AudioPlayer`, `AudioEvaluation`

## 主な機能

### 1. ユーザー認証
- サインアップ/サインイン
- ユーザープロフィール管理
- セッション管理

### 2. 音声ファイル管理
- 音声ファイルのアップロード（最大10MB）
- 音声ファイルの再生
- 音声ファイルの削除

### 3. 音声評価
- スコアリング（0-100）
- フィードバックの提供
- 評価履歴の管理

## データベース設計

### テーブル構造
1. **user_profiles**
   - ユーザー情報の管理
   - 認証情報との連携

2. **audio_files**
   - 音声ファイル情報の管理
   - ユーザーと読み上げテキストとの関連付け

3. **audio_evaluations**
   - 音声評価情報の管理
   - ユーザーと音声ファイルとの関連付け

## テスト
- ユニットテスト: 各レイヤーのコンポーネント
- インテグレーションテスト: リポジトリ実装
- E2Eテスト: ユーザーインターフェース

## 開発ガイドライン

### コーディング規約
- TypeScriptの厳格な型チェック
- 関数型プログラミングの原則
- テスト駆動開発（TDD）
- クリーンアーキテクチャの原則

### 国際化
- 日本語と英語のサポート
- コンポーネントスコープでの翻訳管理
- 動的な言語切り替え

## 今後の実装予定
1. 音声ファイルの自動評価
   - 音声認識による発音評価
   - 音声波形の分析
   - スコアの自動計算

2. 進捗管理機能
   - ユーザーごとの練習履歴
   - スコアの推移グラフ
   - 目標設定と達成度の管理

3. コミュニティ機能
   - 他のユーザーの評価の閲覧
   - 評価へのコメント
   - おすすめの練習テキスト

## セットアップ
1. リポジトリのクローン
```bash
git clone [repository-url]
```

2. bunのインストール（まだの場合）
```bash
curl -fsSL https://bun.sh/install | bash
```

3. 依存関係のインストール
```bash
bun install
```

4. 環境変数の設定
```bash
cp .env.example .env.local
```

5. 開発サーバーの起動
```bash
bun run dev
```

6. テストの実行
```bash
bun test
```

## パッケージマネージャーについて
このプロジェクトでは、高速で効率的な`bun`をパッケージマネージャーとして採用しています。

### bunを選んだ理由
- **高速なインストール**: npmやyarnと比較して、依存関係のインストールが大幅に高速
- **TypeScriptのネイティブサポート**: 追加の設定なしでTypeScriptをサポート
- **テストランナーの統合**: ビルトインのテストランナーを提供
- **モダンな機能**: 最新のJavaScript/TypeScript機能をサポート

### 代替パッケージマネージャー
- **pnpm**: ディスク容量を効率的に使用する場合の選択肢
- **yarn**: 従来の安定性を重視する場合の選択肢
- **npm**: 最も広く使用されているが、比較的遅い 